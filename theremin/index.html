<!DOCTYPE html>
<html>
  <head>
    <title>Theremin</title>
    <meta charset="utf-8"/>
    <script type="text/javascript" src="elm.js"></script>
    <script>
      function init() {

        // create web audio api context
        var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        // create Oscillator and gain node
        var oscillator = audioCtx.createOscillator();
        var gainNode = audioCtx.createGain();
        // connect oscillator to gain node to speakers
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        // We'll set the initial oscillator frequency to 3000 Hertz.
        var initialFreq = 3000;
        // We'll set the initial volume to 0.001
        var initialVol = 0.001;
        // and we'll set some options for the oscillator
        oscillator.type = 'square';
        oscillator.frequency.value = initialFreq;
        oscillator.detune.value = 100;
        oscillator.start(0);
        // set options for the gain node
        gainNode.gain.value = initialVol;

        var app = Elm.Main.fullscreen();

        /*
        app.ports.gain.subscribe(function(value){
          gainNode.gain.value = value;
        });
        */

        app.ports.audio.subscribe(function(model){
          gainNode.gain.value = model.gain;
          oscillator.frequency.value = model.frequency;
        });
      }
    </script>
  </head>
  <body onload="init()">
  </body>
</html>
